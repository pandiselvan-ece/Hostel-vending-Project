<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hostel Vending — MVP</title>
<link rel="preconnect" href="https://fonts.gstatic.com">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
  :root{
    --bg:#f0f8ff;
    --card:#ffffff;
    --muted:#6b7785;
    --accent:#0ea5ff; /* bright blue */
    --accent-2:#0b6fbf;
    --success:#10b981;
    --danger:#ef4444;
    --radius:12px;
    --shadow: 0 12px 36px rgba(2,6,23,0.06);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Arial;color:#07203a;background:linear-gradient(180deg,#eef9ff,#f8fdff);min-height:100vh}
  header{display:flex;justify-content:space-between;align-items:center;padding:12px 18px;border-bottom:1px solid rgba(3,10,18,0.04);background:transparent}
  .brand{font-weight:800;color:var(--accent-2);font-size:18px}
  .top-actions{display:flex;gap:8px;align-items:center}
  button{cursor:pointer;border:none;padding:8px 12px;border-radius:10px;font-weight:700;transition:transform .14s,box-shadow .14s}
  .btn{background:transparent;color:var(--accent-2)}
  .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;box-shadow:0 10px 30px rgba(11,111,191,0.12)}
  .btn.ghost{background:transparent;border:1px solid rgba(3,10,18,0.06);color:var(--accent-2)}
  .small{padding:6px 8px;font-size:13px}
  .container{max-width:1100px;margin:20px auto;padding:0 16px}
  .auth-card{max-width:640px;margin:18px auto;background:var(--card);padding:18px;border-radius:var(--radius);box-shadow:var(--shadow)}
  .tabs{display:flex;gap:8px;margin-bottom:12px}
  .tab{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(3,10,18,0.04);text-align:center;cursor:pointer}
  .tab.active{background:linear-gradient(90deg, rgba(14,165,255,0.06), rgba(11,111,191,0.04));border:none;color:var(--accent-2);font-weight:700}
  input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(3,10,18,0.06);margin:8px 0;background:transparent}
  .muted{color:var(--muted);font-size:14px}
  .grid{display:grid;grid-template-columns:repeat(6,1fr);gap:14px}
  .card{background:var(--card);border-radius:10px;padding:12px;text-align:center;box-shadow:var(--shadow);border:1px solid rgba(3,10,18,0.03);transition:transform .12s}
  .card:hover{transform:translateY(-8px)}
  .card img{width:100%;height:120px;object-fit:cover;border-radius:8px;margin-bottom:8px}
  .slot{font-weight:800;color:var(--accent-2);font-size:13px}
  .item{font-weight:700;margin:6px 0}
  .price{color:var(--accent);font-weight:800}
  .topbar-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .orders-list{max-height:360px;overflow:auto;padding:6px}
  .order-item{background:var(--card);padding:10px;border-radius:10px;margin-bottom:10px;display:flex;gap:10px;align-items:center;box-shadow:var(--shadow)}
  .order-item img{width:64px;height:64px;object-fit:cover;border-radius:8px}
  .admin-panel{display:none;background:linear-gradient(180deg,rgba(11,111,191,0.03),transparent);padding:14px;border-radius:12px;border:1px solid rgba(11,111,191,0.06);box-shadow:var(--shadow);margin-top:12px}
  /* modal */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.45);z-index:80}
  .modal.open{display:flex}
  .modal-card{width:420px;background:var(--card);border-radius:12px;padding:18px;box-shadow:0 30px 80px rgba(2,6,23,0.6);position:relative;transform:translateY(8px);opacity:0;animation:slideIn .26s ease forwards}
  @keyframes slideIn{to{transform:none;opacity:1}}
  .close-x{position:absolute;right:12px;top:8px;border:none;background:none;font-size:20px;cursor:pointer}
  .admin-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
  .admin-card{padding:10px;border-radius:10px;background:linear-gradient(180deg,rgba(14,165,255,0.03),transparent);border:1px solid rgba(14,165,255,0.06)}
  .flex{display:flex;align-items:center;gap:8px}
  .center{display:flex;justify-content:center;align-items:center}
  footer{padding:18px;text-align:center;color:var(--muted)}
  @media (max-width:980px){ .grid{grid-template-columns:repeat(3,1fr)} .admin-grid{grid-template-columns:repeat(1,1fr)} .modal-card{width:92%} }
  @media (max-width:540px){ .grid{grid-template-columns:repeat(2,1fr)} .brand{font-size:16px} }
  small.note{display:block;color:var(--muted);margin-top:6px}
</style>
</head>
<body>
<header>
  <div class="brand">Hostel Vending — Blue</div>
  <div class="top-actions">
    <div id="loggedUser" style="display:none" class="muted"></div>
    <button id="btn-auth" class="btn ghost small">Login / Register</button>
    <button id="btn-admin" class="btn" style="background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff">Admin</button>
  </div>
</header>

<main class="container" id="app">
  <!-- Auth card -->
  <section class="auth-card" id="authCard">
    <div class="tabs">
      <div id="tabLogin" class="tab active">Login</div>
      <div id="tabRegister" class="tab">Register</div>
    </div>
    <div id="loginBox">
      <input id="loginMob" placeholder="Mobile number (10 digits)" />
      <input id="loginPass" type="password" placeholder="Password" />
      <div class="center" style="margin-top:6px">
        <button id="loginBtn" class="btn primary">Login</button>
      </div>
      <p id="loginMsg" class="muted"></p>
    </div>

    <div id="regBox" style="display:none">
      <input id="regName" placeholder="Full name" />
      <input id="regMob" placeholder="Mobile number (10 digits)" />
      <input id="regRoom" placeholder="Room (e.g. 402A)" />
      <input id="regPass" type="password" placeholder="Password (min 4 chars)" />
      <div class="center" style="margin-top:6px">
        <button id="regBtn" class="btn primary">Register</button>
      </div>
      <p id="regMsg" class="muted"></p>
    </div>
  </section>

  <!-- Dashboard -->
  <section id="dashboard" style="display:none">
    <div class="topbar-row">
      <div>
        <h2 style="margin:0">Hello, <span id="userNameDisplay"></span></h2>
        <div class="muted">Order items from the vending machine; delivery person will call to verify.</div>
      </div>
      <div class="flex">
        <button id="btn-cart" class="btn ghost small">Cart (<span id="cartCount">0</span>)</button>
        <button id="btn-logout" class="btn">Logout</button>
      </div>
    </div>

    <h4>Vending Machine (A1 - G6)</h4>
    <div id="productGrid" class="grid" aria-live="polite"></div>

    <h4 style="margin-top:18px">My Orders</h4>
    <div id="myOrders" class="orders-list"></div>

    <!-- Admin panel (hidden unless admin logged) -->
    <div id="adminPanel" class="admin-panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>Admin Panel</strong><div class="muted">Manage slots & orders</div></div>
        <div class="flex">
          <button id="exportBtn" class="btn ghost small">Export</button>
          <input id="importFile" type="file" accept=".json" />
          <button id="closeAdminBtn" class="btn">Close Admin</button>
        </div>
      </div>

      <div id="adminGrid" class="admin-grid"></div>

      <hr style="margin:12px 0" />
      <h4>All Orders</h4>
      <div id="ordersAll" class="orders-list"></div>
    </div>
  </section>
</main>

<!-- Cart Modal -->
<div id="cartModal" class="modal" aria-hidden="true">
  <div class="modal-card">
    <button class="close-x" id="closeCart">&times;</button>
    <h3>Your Cart</h3>
    <div id="cartItems" style="max-height:320px;overflow:auto;margin-top:8px"></div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
      <strong>Total: ₹<span id="cartTotal">0</span></strong>
      <div>
        <button id="checkoutBtn" class="btn primary">Place Order</button>
        <button id="clearCart" class="btn" style="margin-left:8px">Clear</button>
      </div>
    </div>
    <small class="note">Delivery person will call the number you provide when placing order.</small>
  </div>
</div>

<!-- Place Order Modal (single item) -->
<div id="orderModal" class="modal" aria-hidden="true">
  <div class="modal-card">
    <button class="close-x" id="closeOrder">&times;</button>
    <img id="orderImg" src="" style="width:160px;height:120px;object-fit:cover;border-radius:8px;margin:8px auto;display:block"/>
    <h3 id="orderTitle" style="text-align:center"></h3>
    <p id="orderSlot" class="muted" style="text-align:center"></p>
    <label class="muted">Phone for verification</label>
    <input id="orderPhone" placeholder="10-digit phone" />
    <label class="muted">Room (optional)</label>
    <input id="orderRoom" placeholder="e.g. 402A" />
    <div class="center" style="margin-top:12px">
      <button id="confirmBtn" class="btn primary">Place Order</button>
      <button id="cancelBtn" class="btn" style="margin-left:8px">Cancel</button>
    </div>
    <p id="orderMsg" class="muted"></p>
  </div>
</div>

<script>
/* Compact SPA (localStorage) */
/* Admin credentials requested: ID = PANDI, PASS = 6467
   Data stores:
   - items: object keyed by slot (A1..G6) in 'hv_items'
   - users: map by mobile in 'hv_users' -> {name,mobile,room,password}
   - orders: array in 'hv_orders'
   - cart: sessionStorage per user -> hv_cart_{mobile}
*/

const S_ITEMS = 'hv_items_v3';
const S_USERS = 'hv_users_v3';
const S_ORDERS = 'hv_orders_v3';

const ADMIN_ID = 'PANDI', ADMIN_PASS = '6467';

const rows = ['A','B','C','D','E','F','G'], cols=[1,2,3,4,5,6];
const SLOTS = []; rows.forEach(r=>cols.forEach(c=>SLOTS.push(r+c)));

function load(key, fallback){ try{ const j=localStorage.getItem(key); if(!j){ localStorage.setItem(key, JSON.stringify(fallback)); return fallback;} return JSON.parse(j);}catch(e){ localStorage.setItem(key, JSON.stringify(fallback)); return fallback; } }
function save(key,val){ localStorage.setItem(key, JSON.stringify(val)); }
function uid(){ return 'id'+Date.now().toString(36).slice(4); }
function placeholder(slot){ const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='800' height='500'><rect width='100%' height='100%' fill='#f3f7fb'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='48' fill='#9fb6cf'>${slot}</text></svg>`; return 'data:image/svg+xml;base64,'+btoa(svg); }

/* ensure defaults */
(function initDefaults(){
  const items = load(S_ITEMS, null);
  if(!items){
    const o={};
    SLOTS.forEach(s=> o[s] = {slot:s, name:'Empty Slot', price:'', img:placeholder(s)});
    o['A1'].name='Lays (Small)'; o['A1'].price='20';
    o['A2'].name='Coke 300ml'; o['A2'].price='35';
    o['A3'].name='Biscuits'; o['A3'].price='15';
    save(S_ITEMS,o);
  }
  load(S_USERS, {}); load(S_ORDERS, []);
})();

/* DOM refs */
const el = id=>document.getElementById(id);
/* auth UI */
el('tabLogin').onclick = ()=>{ el('tabLogin').classList.add('active'); el('tabRegister').classList.remove('active'); el('loginBox').style.display='block'; el('regBox').style.display='none'; };
el('tabRegister').onclick = ()=>{ el('tabRegister').classList.add('active'); el('tabLogin').classList.remove('active'); el('regBox').style.display='block'; el('loginBox').style.display='none'; };

el('regBtn').onclick = ()=>{ const name=el('regName').value.trim(), mob=el('regMob').value.trim(), room=el('regRoom').value.trim(), pass=el('regPass').value; const msg=el('regMsg'); msg.textContent=''; if(!name||!mob||!pass){ msg.textContent='Fill all fields'; return;} if(!/^\d{10}$/.test(mob)){ msg.textContent='Enter 10-digit mobile'; return;} if(pass.length<4){ msg.textContent='Password >=4 chars'; return;} const users = load(S_USERS,{}); if(users[mob]){ msg.textContent='Mobile already registered'; return;} users[mob] = {name,mobile:mob,room,pass}; save(S_USERS,users); sessionStorage.setItem('hv_user',mob); showDashboard(); };

el('loginBtn').onclick = ()=>{ const mob=el('loginMob').value.trim(), pass=el('loginPass').value; const msg=el('loginMsg'); msg.textContent=''; const users=load(S_USERS,{}); if(!users[mob]||users[mob].pass!==pass){ msg.textContent='Invalid mobile or password'; return;} sessionStorage.setItem('hv_user',mob); showDashboard(); };

el('btn-auth').onclick = ()=>{ // scroll to auth
  document.querySelector('.auth-card').scrollIntoView({behavior:'smooth'});
};

/* admin button opens prompt login */
el('btn-admin').onclick = ()=> {
  const id = prompt('Admin ID:'); if(id===null) return;
  const pass = prompt('Password:'); if(pass===null) return;
  if(id===ADMIN_ID && pass===ADMIN_PASS){ openAdmin(); } else alert('Invalid admin credentials');
};

/* logout */
el('btn-logout')?.addEventListener?.('click', ()=> { sessionStorage.removeItem('hv_user'); updateUI(); });

/* show/hide UI */
function updateUI(){
  const user = sessionStorage.getItem('hv_user');
  if(user){
    el('authCard').style.display='none'; el('dashboard').style.display='block'; el('loggedUser').style.display='inline'; el('loggedUser').textContent = load(S_USERS,{})[user].name + ' ('+user+')';
    el('userNameDisplay').textContent = load(S_USERS,{})[user].name;
    renderProducts();
    renderUserOrders();
    el('adminPanel').style.display = 'none';
  } else {
    el('authCard').style.display='block'; el('dashboard').style.display='none'; el('loggedUser').style.display='none';
  }
}
updateUI();

/* Products rendering */
function renderProducts(){
  const grid = el('productGrid'); grid.innerHTML=''; const items = load(S_ITEMS,{});
  Object.keys(items).sort().forEach(slot=>{
    const it = items[slot];
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `<div class="slot">${slot}</div><img src="${it.img}" /><div class="item">${escape(it.name)}</div><div class="price">${it.price? '₹'+escape(it.price): '-'}</div><div style="margin-top:8px"><button class="btn" data-slot="${slot}">Add to Cart</button></div>`;
    grid.appendChild(card);
  });
  grid.querySelectorAll('button[data-slot]').forEach(btn=> btn.onclick = e=> addToCart(e.currentTarget.getAttribute('data-slot')) );
}

/* Cart (per-user in sessionStorage) */
function cartKey(){ const u=sessionStorage.getItem('hv_user'); return 'hv_cart_'+(u||'guest'); }
function getCart(){ return JSON.parse(sessionStorage.getItem(cartKey())||'[]'); }
function saveCart(items){ sessionStorage.setItem(cartKey(), JSON.stringify(items)); el('cartCount').textContent = getCart().length; }
function addToCart(slot){
  const user = sessionStorage.getItem('hv_user'); if(!user){ alert('Login to add to cart'); return; }
  const items = load(S_ITEMS,{}); const it = items[slot];
  const cart = getCart();
  cart.push({slot, name: it.name, price: it.price});
  saveCart(cart);
  openCart();
}
el('btn-cart').onclick = openCart;
function openCart(){ renderCart(); el('cartModal').classList.add('open'); }
el('closeCart').onclick = ()=> el('cartModal').classList.remove('open');
el('clearCart').onclick = ()=>{ if(confirm('Clear cart?')){ saveCart([]); renderCart(); } };

/* render cart */
function renderCart(){
  const c = getCart(); const container = el('cartItems'); container.innerHTML=''; let total=0;
  if(c.length===0){ container.innerHTML='<div class="muted">Cart empty</div>'; el('cartTotal').textContent='0'; return; }
  c.forEach((it,idx)=>{ const div=document.createElement('div'); div.style.display='flex'; div.style.justifyContent='space-between'; div.style.alignItems='center'; div.style.padding='8px 0'; div.innerHTML=`<div>${escape(it.name)} <small class="muted">(${it.slot})</small></div><div>₹${it.price || 0} <button class="btn" data-idx="${idx}" style="margin-left:8px">Remove</button></div>`; container.appendChild(div); total += Number(it.price||0); });
  container.querySelectorAll('button[data-idx]').forEach(b=> b.onclick = e=>{ const i=+e.currentTarget.getAttribute('data-idx'); const arr=getCart(); arr.splice(i,1); saveCart(arr); renderCart(); });
  el('cartTotal').textContent = total;
}

/* Checkout -> create orders from cart */
el('checkoutBtn').onclick = ()=> {
  const user = sessionStorage.getItem('hv_user'); if(!user) { alert('Login first'); return; }
  const cart = getCart(); if(cart.length===0){ alert('Cart is empty'); return; }
  const users = load(S_USERS,{}); const profile = users[user];
  const phone = prompt('Enter phone for verification (10 digits) — will be called by delivery person', profile.phone||'');
  if(!phone || !/^\d{10}$/.test(phone)){ alert('Enter valid 10-digit phone'); return; }
  const room = prompt('Enter room (optional)', profile.room||'') || '';
  const orders = load(S_ORDERS,[]);
  cart.forEach(it => {
    orders.unshift({ id: uid(), username: profile.name, userMobile: user, slot: it.slot, itemName: it.name, price: it.price||'', phone, room, status:'pending', createdAt: new Date().toISOString() });
  });
  save(S_ORDERS, orders); saveCart([]); renderCart(); el('cartModal').classList.remove('open'); renderUserOrders(); renderOrdersAll();
  alert('Order placed. Delivery person will call the provided phone number.');
};

/* User orders */
function renderUserOrders(){
  const list = el('myOrders'); list.innerHTML=''; const user = sessionStorage.getItem('hv_user'); if(!user){ list.innerHTML='<div class="muted">Login to see orders</div>'; return; }
  const orders = load(S_ORDERS,[]).filter(o=> o.userMobile===user);
  if(orders.length===0){ list.innerHTML='<div class="muted">No orders</div>'; return; }
  orders.forEach(o=>{
    const div=document.createElement('div'); div.className='order-item';
    div.innerHTML = `<img src="${(load(S_ITEMS,{})[o.slot]||{}).img||placeholder(o.slot)}" /><div style="flex:1"><div style="display:flex;justify-content:space-between"><strong>${escape(o.itemName)}</strong><span class="muted">${o.price? '₹'+o.price:''}</span></div><div class="muted">${o.room} • ${o.phone}</div><div class="muted">Status: <strong>${o.status}</strong></div><small class="muted">${new Date(o.createdAt).toLocaleString()}</small></div>`;
    list.appendChild(div);
  });
}

/* single-item order modal (if you want buy single) - not used in cart flow but included */
let currentSlot = null;
function openOrderModal(slot){
  currentSlot = slot;
  const it = load(S_ITEMS,{})[slot];
  el('orderImg').src = it.img;
  el('orderTitle').textContent = it.name + (it.price? ' — ₹'+it.price : '');
  el('orderSlot').textContent = slot;
  const user = sessionStorage.getItem('hv_user'); if(user){ const prof = load(S_USERS,{})[user]; el('orderPhone').value = prof.phone||''; el('orderRoom').value = prof.room||''; }
  el('orderMsg').textContent=''; el('orderModal').classList.add('open');
}
el('closeOrder').onclick = ()=> el('orderModal').classList.remove('open');
el('cancelBtn').onclick = ()=> el('orderModal').classList.remove('open');
el('confirmBtn').onclick = ()=> {
  const phone = el('orderPhone').value.trim(); const room = el('orderRoom').value.trim(); const user = sessionStorage.getItem('hv_user'); if(!user){ alert('Login first'); return; } if(!/^\d{10}$/.test(phone)){ el('orderMsg').textContent='Enter valid 10-digit phone'; return; }
  const items = load(S_ITEMS,{}); const it = items[currentSlot]; const orders = load(S_ORDERS,[]);
  orders.unshift({id:uid(), username: load(S_USERS,{})[user].name, userMobile:user, slot:currentSlot, itemName:it.name, price:it.price||'', phone, room, status:'pending', createdAt: new Date().toISOString()});
  save(S_ORDERS,orders); el('orderModal').classList.remove('open'); renderUserOrders(); renderOrdersAll(); alert('Order placed.');
};

/* Admin section */
function openAdmin(){
  el('adminPanel').style.display='block'; renderAdminGrid(); renderOrdersAll();
}
el('closeAdminBtn').onclick = ()=> el('adminPanel').style.display='none';
el('exportBtn').onclick = ()=> { const items = load(S_ITEMS,{}); const blob = new Blob([JSON.stringify(items, null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='items.json'; a.click(); URL.revokeObjectURL(a.href); };
el('importFile').onchange = e=> { const f=e.target.files[0]; if(!f) return; const fr=new FileReader(); fr.onload=()=>{ try{ const data=JSON.parse(fr.result); const ok=SLOTS.every(s=> data[s]); if(!ok) return alert('Invalid JSON'); save(S_ITEMS,data); renderProducts(); renderAdminGrid(); alert('Imported'); }catch(err){ alert('Import failed'); } }; fr.readAsText(f); };

/* admin grid render */
function renderAdminGrid(){
  const container = el('adminGrid'); container.innerHTML=''; const items = load(S_ITEMS,{});
  Object.keys(items).sort().forEach(slot=>{
    const it = items[slot];
    const card = document.createElement('div'); card.className='admin-card';
    card.innerHTML = `<strong>${slot}</strong><img src="${it.img}" style="width:100%;height:110px;object-fit:cover;border-radius:8px;margin-top:8px" /><input data-slot="${slot}" class="admin-name" placeholder="Name" value="${escape(it.name)}" /><input data-slot="${slot}" class="admin-price" placeholder="Price" value="${escape(it.price)}" /><div style="display:flex;gap:8px;align-items:center;margin-top:8px"><input type="file" data-slot="${slot}" class="admin-file" accept="image/*" /><button class="btn save" data-slot="${slot}">Save</button><button class="btn" style="background:var(--danger);color:#fff" data-slot="${slot}" id="clear-${slot}">Clear</button></div>`;
    container.appendChild(card);
  });
  container.querySelectorAll('.save').forEach(b=> b.onclick = async e=> {
    const slot = e.currentTarget.getAttribute('data-slot');
    const name = container.querySelector(`input.admin-name[data-slot="${slot}"]`).value.trim() || 'Empty Slot';
    const price = container.querySelector(`input.admin-price[data-slot="${slot}"]`).value.trim() || '';
    const file = container.querySelector(`input.admin-file[data-slot="${slot}"]`).files[0];
    const items = load(S_ITEMS,{});
    items[slot].name = name; items[slot].price = price;
    if(file){ try{ const data = await fileToDataURL(file); items[slot].img = data; } catch{ alert('Image read failed'); } }
    save(S_ITEMS,items); renderProducts(); renderAdminGrid(); alert('Saved '+slot);
  });
  container.querySelectorAll('[id^="clear-"]').forEach(b=> b.onclick = e=> {
    const slot = e.currentTarget.id.replace('clear-','');
    if(!confirm('Clear '+slot+'?')) return;
    const items = load(S_ITEMS,{}); items[slot] = {slot, name:'Empty Slot', price:'', img:placeholder(slot)}; save(S_ITEMS,items); renderProducts(); renderAdminGrid();
  });
}

/* orders admin */
function renderOrdersAll(){
  const wrap = el('ordersAll'); wrap.innerHTML=''; const orders = load(S_ORDERS,[]);
  if(orders.length===0){ wrap.innerHTML='<div class="muted">No orders</div>'; return; }
  orders.forEach(o=>{
    const div=document.createElement('div'); div.className='order-item';
    div.innerHTML = `<img src="${(load(S_ITEMS,{})[o.slot]||{}).img||placeholder(o.slot)}" /><div style="flex:1"><div style="display:flex;justify-content:space-between"><strong>${escape(o.itemName)}</strong><span class="muted">${o.price? '₹'+o.price:''}</span></div><div class="muted">${o.username} • ${o.room} • ${o.phone}</div><div class="muted">Status: <strong>${o.status}</strong></div><small class="muted">${new Date(o.createdAt).toLocaleString()}</small><div style="margin-top:8px;display:flex;gap:8px">${o.status==='pending'?`<button class="btn" data-act="pick" data-id="${o.id}">Mark Picked</button>`:''}${o.status!=='delivered'?`<button class="btn" data-act="deliver" data-id="${o.id}">Mark Delivered</button>`:''}<button class="btn" data-act="cancel" data-id="${o.id}" style="background:var(--danger);color:#fff">Cancel</button><button class="btn" data-act="call" data-id="${o.id}">Call</button></div></div>`;
    wrap.appendChild(div);
  });
  wrap.querySelectorAll('button[data-act]').forEach(b=> b.onclick = e=> {
    const act = e.currentTarget.getAttribute('data-act'); const id = e.currentTarget.getAttribute('data-id');
    const orders = load(S_ORDERS,[]); const idx=orders.findIndex(x=>x.id===id); if(idx===-1) return alert('Not found');
    if(act==='pick'){ orders[idx].status='picked'; }
    else if(act==='deliver'){ orders[idx].status='delivered'; }
    else if(act==='cancel'){ orders[idx].status='cancelled'; }
    else if(act==='call'){ const p=orders[idx].phone; if(/^\d{10}$/.test(p)) window.open('tel:'+p); else alert('Invalid phone'); return; }
    save(S_ORDERS,orders); renderOrdersAll(); renderUserOrders();
  });
}

/* utility: read file to base64 */
function fileToDataURL(file){ return new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=()=>rej(); fr.readAsDataURL(file); }); }
function escape(s){ return (s||'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function renderOrdersAll(){ /* placeholder to be replaced when admin opens */ const elAll = document.getElementById('ordersAll'); if(elAll) renderOrdersAll = renderOrdersAllActual; }
function renderOrdersAllActual(){ /* real function defined above, but reassigning to use it */ }

/* helpers to show admin only after login - but our admin is prompt-based above so adminPanel toggles on openAdmin() */

/* wire product click for ordering single (optional) */
document.addEventListener('click', e=>{
  if(e.target.matches('.card img') || e.target.closest('.card') && e.target.tagName==='IMG'){ const btn = e.target.closest('.card'); /* ignore */ }
});

/* update cart count */
(function initCartCount(){ el('cartCount').textContent = getCart().length; })();

/* initial product render */
renderProducts();

/* small hookup to expose openOrderModal when clicking card Buy (single-item) — we already use Add to Cart approach */
/* show dashboard if logged */
if(sessionStorage.getItem('hv_user')) updateUI();

/* convenience: small alias fixes if functions replaced earlier */
if(typeof renderOrdersAllActual === 'function') renderOrdersAll = renderOrdersAllActual;

</script>
<footer><small class="muted">Static MVP — data stored in browser localStorage. For shared devices/data use a backend (can add later).</small></footer>
</body>
</html>
